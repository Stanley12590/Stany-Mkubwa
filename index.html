<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>STANY MIN TV | iOS 26 HIGH-END</title>
    
    <!-- Professional Icons (FontAwesome 6) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <!-- Video Player -->
    <link href="https://vjs.zencdn.net/7.20.3/video-js.css" rel="stylesheet" />
    <script src="https://vjs.zencdn.net/7.20.3/video.min.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.10.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.10.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.10.0/firebase-database-compat.js"></script>

    <style>
        :root {
            --red: #FF0000;
            --black: #000000;
            --white: #FFFFFF;
            --glass: rgba(255, 255, 255, 0.1);
            --blur: blur(40px);
            --sent: #FF0000;
            --received: #262626;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'SF Pro Display', sans-serif; -webkit-tap-highlight-color: transparent; }

        body { background-color: var(--black); color: var(--white); overflow: hidden; height: 100vh; position: fixed; width: 100%; }

        /* --- iOS 26 Auth & Splash --- */
        #auth-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--black); z-index: 10000;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .auth-card {
            background: var(--glass); backdrop-filter: var(--blur);
            padding: 35px; border-radius: 40px; width: 90%; text-align: center;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .ios-input {
            width: 100%; padding: 16px; margin-top: 15px;
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 18px; color: white; outline: none;
        }

        /* --- Ultimate Ad Engine --- */
        #ad-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--black); z-index: 9500; display: none; flex-direction: column;
        }
        .marquee-ad { background: var(--red); color: white; padding: 10px; font-weight: bold; overflow: hidden; font-size: 13px; }
        .marquee-ad span { display: inline-block; white-space: nowrap; animation: marquee 15s linear infinite; }
        @keyframes marquee { from { transform: translateX(100%); } to { transform: translateX(-100%); } }
        .ad-timer { position: absolute; top: 50px; right: 25px; border: 3px solid var(--red); width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 900; background: rgba(0,0,0,0.8); }

        .social-hub { display: grid; grid-template-columns: repeat(6, 1fr); gap: 15px; padding: 25px; background: var(--glass); backdrop-filter: var(--blur); border-top: 1px solid rgba(255,255,255,0.1); }
        .social-hub i { font-size: 22px; color: var(--white); text-align: center; }

        /* --- UI Elements --- */
        header { padding: 60px 20px 15px; background: rgba(0,0,0,0.8); backdrop-filter: var(--blur); position: sticky; top: 0; z-index: 800; display: flex; justify-content: space-between; align-items: center; }
        .logo-text { font-size: 28px; font-weight: 800; letter-spacing: -1px; }

        .bottom-nav { position: fixed; bottom: 30px; left: 20px; right: 20px; height: 75px; background: rgba(20, 20, 20, 0.8); backdrop-filter: var(--blur); border-radius: 40px; display: flex; justify-content: space-around; align-items: center; border: 1px solid rgba(255,255,255,0.1); z-index: 1000; box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
        .nav-item { text-align: center; color: #777; text-decoration: none; font-size: 10px; font-weight: 700; }
        .nav-item i { font-size: 24px; display: block; margin-bottom: 4px; }
        .nav-item.active { color: var(--red); }

        /* --- Chat Interface (Optimized) --- */
        #chat-header { position: fixed; top: 0; left: 0; width: 100%; padding: 60px 20px 15px; background: var(--black); display: none; align-items: center; z-index: 1100; border-bottom: 1px solid var(--glass); }
        #chat-page { display: flex; flex-direction: column; height: 100vh; background: var(--black); }
        #chat-messages { flex: 1; overflow-y: auto; padding: 20px; padding-top: 100px; padding-bottom: 100px; display: flex; flex-direction: column; gap: 10px; }
        
        .msg-bubble { padding: 12px 18px; border-radius: 22px; max-width: 80%; font-size: 15px; line-height: 1.4; position: relative; }
        .msg-sent { background: var(--sent); align-self: flex-end; border-bottom-right-radius: 4px; }
        .msg-received { background: var(--received); align-self: flex-start; border-bottom-left-radius: 4px; }
        .msg-info { font-size: 10px; font-weight: 800; opacity: 0.5; margin-bottom: 4px; display: block; }
        
        .reply-box { background: rgba(0,0,0,0.3); border-left: 3px solid var(--white); padding: 5px 10px; border-radius: 8px; font-size: 12px; margin-bottom: 5px; opacity: 0.8; }

        .chat-input-container { position: fixed; bottom: 0; left: 0; width: 100%; background: var(--black); padding: 10px 20px 40px; border-top: 1px solid var(--glass); z-index: 1200; }
        #reply-bar { background: #1a1a1a; padding: 8px 20px; display: none; justify-content: space-between; align-items: center; font-size: 12px; border-radius: 15px 15px 0 0; }

        /* --- Sections & Carousels --- */
        .page { display: none; padding: 20px; padding-bottom: 120px; overflow-y: auto; height: 100vh; }
        .active-page { display: block; animation: ios-zoom 0.4s ease; }
        @keyframes ios-zoom { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }

        .carousel { display: flex; overflow-x: auto; scroll-snap-type: x mandatory; gap: 15px; padding-bottom: 15px; scrollbar-width: none; }
        .carousel::-webkit-scrollbar { display: none; }
        .slide { min-width: 88%; height: 210px; border-radius: 35px; scroll-snap-align: center; position: relative; overflow: hidden; border: 1px solid var(--glass); }
        .slide img { width: 100%; height: 100%; object-fit: cover; }

        /* --- More Services Sub-pages --- */
        .sub-page { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--black); z-index: 2000; display: none; padding: 80px 20px; overflow-y: auto; }

        /* Simulizi Reader */
        .reader-view { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--black); z-index: 3000; display: none; }
        .drop-image-bg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-size: cover; background-position: center; filter: blur(60px) brightness(0.2); z-index: -1; }

        .card { background: var(--glass); backdrop-filter: var(--blur); border-radius: 28px; border: 1px solid rgba(255,255,255,0.08); padding: 18px; margin-bottom: 15px; }
        .btn-red { background: var(--red); color: white; border: none; padding: 18px; border-radius: 30px; font-weight: 700; width: 100%; cursor: pointer; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <!-- Auth System -->
    <div id="auth-screen">
        <div class="auth-card" id="login-box">
            <div style="width: 85px; height: 85px; border: 4px solid var(--red); border-radius: 24px; margin: 0 auto 25px; animation: pulse 2s infinite;"></div>
            <h1 style="font-weight: 800;">STANY <span style="color:var(--red)">MIN TV</span></h1>
            <div id="auth-forms">
                <input type="email" id="email" class="ios-input" placeholder="Email">
                <input type="password" id="pass" class="ios-input" placeholder="Password">
                <button class="btn-red" style="margin-top:20px" onclick="authAction('login')">Sign In</button>
                <button class="btn-red" style="background:transparent; border:1px solid var(--red); margin-top:10px" onclick="toggleAuth('reg')">Register Account</button>
                <button class="btn-red" style="background:white; color:black; margin-top:20px" onclick="googleSignIn()">
                    <i class="fa-brands fa-google"></i> Google Login
                </button>
            </div>
        </div>
        <div class="auth-card hidden" id="reg-box">
            <h2>Sign Up</h2>
            <input type="text" id="reg-name" class="ios-input" placeholder="Full Name">
            <input type="email" id="reg-email" class="ios-input" placeholder="Email Address">
            <input type="password" id="reg-pass" class="ios-input" placeholder="Password">
            <button class="btn-red" style="margin-top:20px" onclick="authAction('reg')">Create Account</button>
            <p onclick="toggleAuth('login')" style="margin-top:20px; font-size:12px; opacity:0.6">Back to Sign In</p>
        </div>
    </div>

    <!-- Ad Overlay -->
    <div id="ad-overlay">
        <div class="marquee-ad"><span>• ADVERTISEMENT • VISIT STANYMINTV.COM • OFFICIAL PARTNER • PREMIUM QUALITY •</span></div>
        <div style="flex:1; display:flex; align-items:center; justify-content:center; position:relative;">
            <div class="ad-timer" id="ad-timer">15</div>
            <img id="ad-img" style="width:100%; max-height:75vh; object-fit:contain;">
        </div>
        <div id="ad-social-hub" class="social-hub"></div>
        <div class="marquee-ad"><span>• POWERED BY STANY MIN TV PRO • CLICK ICONS TO JOIN •</span></div>
    </div>

    <!-- Main App Header -->
    <header id="main-header">
        <div class="logo-text">STANY <span style="color:var(--red)">MIN</span></div>
        <i class="fa-solid fa-magnifying-glass" style="font-size: 22px;"></i>
    </header>

    <!-- Chat Header -->
    <div id="chat-header">
        <i class="fa-solid fa-chevron-left" style="font-size: 26px; color: var(--red);" onclick="closeChat()"></i>
        <span style="margin-left: 20px; font-weight: 800; font-size: 20px;">MESSAGES</span>
    </div>

    <main>
        <!-- Home / Live -->
        <section id="live" class="page active-page">
            <div class="carousel" id="live-carousel"></div>
            <h3 style="margin-bottom:20px;"><i class="fa-solid fa-satellite-dish" style="color:var(--red)"></i> &nbsp; Live TV</h3>
            <div id="live-list" style="display:grid; grid-template-columns:repeat(3, 1fr); gap:12px;"></div>
        </section>

        <!-- Movies -->
        <section id="movies" class="page">
            <div class="carousel" id="movie-carousel"></div>
            <h3 style="margin:25px 0 15px;"><i class="fa-solid fa-film" style="color:var(--red)"></i> &nbsp; Cinema</h3>
            <div id="movie-list" style="display:grid; grid-template-columns:repeat(2, 1fr); gap:15px;"></div>
        </section>

        <!-- Adult 18+ -->
        <section id="adult" class="page">
            <div id="age-gate" class="card" style="text-align:center; padding:60px 20px;">
                <i class="fa-solid fa-circle-exclamation" style="font-size:55px; color:var(--red);"></i>
                <h2 style="margin:20px 0;">18+ Verification</h2>
                <p style="opacity:0.7;">This section is restricted. Confirm you are of legal age?</p>
                <button class="btn-red" style="margin-top:20px" onclick="unlockAdult()">Confirm & Enter</button>
            </div>
            <div id="adult-content" class="hidden">
                <div class="carousel" id="adult-carousel"></div>
                <div id="adult-list" style="display:grid; grid-template-columns:repeat(2, 1fr); gap:15px;"></div>
            </div>
        </section>

        <!-- Chat Advanced -->
        <section id="chat" class="page" style="padding:0;">
            <div id="chat-page">
                <div style="display:flex; background:var(--glass); border-radius:20px; padding:5px; margin: 100px 20px 10px;">
                    <div id="btn-pub" style="flex:1; text-align:center; padding:12px; border-radius:15px; cursor:pointer; font-weight:800; font-size:12px;" onclick="setChatMode('public')">PUBLIC</div>
                    <div id="btn-bot" style="flex:1; text-align:center; padding:12px; border-radius:15px; cursor:pointer; font-weight:800; font-size:12px;" onclick="setChatMode('bot')">BOT</div>
                </div>
                <div id="chat-messages"></div>
                <div class="chat-input-container">
                    <div id="reply-bar">
                        <span id="reply-info">Replying...</span>
                        <i class="fa-solid fa-xmark" onclick="cancelReply()"></i>
                    </div>
                    <div style="display:flex; gap:10px;">
                        <input type="text" id="chat-input" class="ios-input" style="margin:0; border-radius:30px;" placeholder="Message...">
                        <button onclick="sendMsg()" style="background:var(--red); border:none; width:52px; height:52px; border-radius:50%; color:white;"><i class="fa-solid fa-paper-plane"></i></button>
                    </div>
                </div>
            </div>
        </section>

        <!-- More Services Fix -->
        <section id="more" class="page">
            <div class="carousel" id="more-carousel"></div>
            <h3 style="margin-bottom:25px;">More <span style="color:var(--red)">Services</span></h3>
            <div class="card" onclick="openSub('stories')"><i class="fa-solid fa-book" style="color:var(--red)"></i> &nbsp; Simulizi (Stories)</div>
            <div class="card" onclick="openSub('tech')"><i class="fa-solid fa-user-shield" style="color:var(--red)"></i> &nbsp; Tech Updates</div>
            <div class="card" onclick="openSub('betting')"><i class="fa-solid fa-chart-line" style="color:var(--red)"></i> &nbsp; Betting Tips</div>
            <div class="card" onclick="openSub('download')"><i class="fa-solid fa-download" style="color:var(--red)"></i> &nbsp; Downloads</div>
            <div class="card" onclick="signOutAccount()"><i class="fa-solid fa-power-off"></i> &nbsp; Sign Out</div>
        </section>
    </main>

    <!-- Sub Pages Content -->
    <div id="stories-sub" class="sub-page">
        <i class="fa-solid fa-chevron-left" onclick="closeSub('stories-sub')" style="font-size:26px; margin-bottom:25px;"></i>
        <div id="stories-render"></div>
    </div>
    <div id="tech-sub" class="sub-page">
        <i class="fa-solid fa-chevron-left" onclick="closeSub('tech-sub')" style="font-size:26px; margin-bottom:25px;"></i>
        <div id="tech-render"></div>
    </div>
    <div id="betting-sub" class="sub-page">
        <i class="fa-solid fa-chevron-left" onclick="closeSub('betting-sub')" style="font-size:26px; margin-bottom:25px;"></i>
        <div id="betting-render"></div>
    </div>
    <div id="download-sub" class="sub-page">
        <i class="fa-solid fa-chevron-left" onclick="closeSub('download-sub')" style="font-size:26px; margin-bottom:25px;"></i>
        <div id="download-render"></div>
    </div>

    <!-- Reader -->
    <div id="reader-view" class="reader-view">
        <div class="drop-image-bg" id="read-bg"></div>
        <div style="flex:1; overflow-y:auto; padding:70px 25px;">
            <i class="fa-solid fa-chevron-down" onclick="exitReader()" style="font-size:35px; margin-bottom:40px;"></i>
            <h1 id="read-title" style="color:var(--red); text-align:center;"></h1>
            <p id="read-author" style="text-align:center; opacity:0.6; margin-bottom:35px;"></p>
            <div class="card" style="background:rgba(0,0,0,0.6);" id="read-body"></div>
            <div style="display:flex; justify-content:space-between; margin-top:35px;">
                <button class="btn-red" style="width:45%; background:#222;" onclick="turnStoryPage(-1)">BACK</button>
                <button class="btn-red" style="width:45%;" onclick="turnStoryPage(1)">NEXT</button>
            </div>
        </div>
    </div>

    <!-- Nav -->
    <div class="bottom-nav" id="bottom-nav">
        <a href="javascript:void(0)" class="nav-item active" onclick="navTo('live', this)"><i class="fa-solid fa-tv"></i>Live</a>
        <a href="javascript:void(0)" class="nav-item" onclick="navTo('movies', this)"><i class="fa-solid fa-film"></i>Movies</a>
        <a href="javascript:void(0)" class="nav-item" onclick="navTo('adult', this)"><i class="fa-solid fa-pepper-hot"></i>Adult</a>
        <a href="javascript:void(0)" class="nav-item" onclick="navTo('chat', this)"><i class="fa-solid fa-comments"></i>Chat</a>
        <a href="javascript:void(0)" class="nav-item" onclick="navTo('more', this)"><i class="fa-solid fa-grip-vertical"></i>More</a>
    </div>

    <!-- Player Window -->
    <div id="player-view" class="hidden" style="position:fixed; top:0; left:0; width:100%; height:100%; background:#000; z-index:9000;">
        <i class="fa-solid fa-xmark" onclick="stopPlayer()" style="position:absolute; top:45px; right:25px; z-index:9100; font-size: 35px;"></i>
        <video id="stany-player" class="video-js vjs-big-play-centered" controls style="width:100%; height:100%;"></video>
    </div>

    <script>
        // --- FIREBASE CONFIG (STANYMINTV.COM) ---
        const firebaseConfig = {
            apiKey: "AIzaSyDiexD5WK9GLhQldr6zNmC8iYWc4em5eyM",
            authDomain: "stany-min-tv.firebaseapp.com",
            databaseURL: "https://stany-min-tv-default-rtdb.firebaseio.com",
            projectId: "stany-min-tv",
            storageBucket: "stany-min-tv.firebasestorage.app",
            messagingSenderId: "16513327552",
            appId: "1:16513327552:web:b4b2247053f83aa0b8e825",
            measurementId: "G-JM25LJXL5C"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const auth = firebase.auth();

        let isPremium = false, activeChat = 'public', replyTarget = null;
        let myHWID = localStorage.getItem('hwid') || 'STANY-'+Math.random().toString(36).substr(2,9);
        localStorage.setItem('hwid', myHWID);

        // --- AUTH ---
        function toggleAuth(t) { document.getElementById('login-box').classList.toggle('hidden', t==='reg'); document.getElementById('reg-box').classList.toggle('hidden', t==='login'); }
        function googleSignIn() { auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()).then(r => checkHWID(r.user)); }
        function authAction(mode) {
            const e = mode==='reg' ? document.getElementById('reg-email').value : document.getElementById('email').value;
            const p = mode==='reg' ? document.getElementById('reg-pass').value : document.getElementById('pass').value;
            if(mode==='reg') {
                auth.createUserWithEmailAndPassword(e, p).then(r => {
                    r.user.updateProfile({displayName: document.getElementById('reg-name').value});
                    checkHWID(r.user);
                }).catch(err => alert(err.message));
            } else { auth.signInWithEmailAndPassword(e, p).then(r => checkHWID(r.user)).catch(err => alert(err.message)); }
        }
        function checkHWID(user) {
            db.ref('users/'+user.uid).once('value', s => {
                const u = s.val();
                if(u && u.hwid && u.hwid !== myHWID) { alert("One device allowed only."); auth.signOut(); location.reload(); }
                else {
                    if(!u || !u.hwid) db.ref('users/'+user.uid).update({hwid: myHWID, email: user.email, name: user.displayName || 'User'});
                    isPremium = u ? u.isPremium : false;
                    document.getElementById('auth-screen').style.display = 'none';
                    loadCore();
                }
            });
        }
        auth.onAuthStateChanged(u => { if(u) checkHWID(u); });

        // --- ADS ---
        function triggerAd(cb) {
            if(isPremium) return cb();
            const ov = document.getElementById('ad-overlay'); ov.style.display = 'flex';
            db.ref('ads/config').once('value', s => {
                const c = s.val(); document.getElementById('ad-img').src = c.image;
                const h = document.getElementById('ad-social-hub'); h.innerHTML = '';
                if(c.socialHub) c.socialHub.forEach(i => h.innerHTML += `<i class="${i.icon}" onclick="window.open('${i.url}')"></i>`);
                let t = c.duration || 15;
                const timer = setInterval(() => {
                    t--; document.getElementById('ad-timer').innerText = t;
                    if(t<=0) { clearInterval(timer); ov.style.display = 'none'; cb(); }
                }, 1000);
            });
        }

        // --- CORE ---
        function loadCore() {
            // Carousels for all Sections
            ['live', 'movie', 'adult', 'more'].forEach(type => {
                db.ref('carousels/'+type).on('value', snap => {
                    const slider = document.getElementById(type+'-carousel'); if(!slider) return; slider.innerHTML = '';
                    snap.forEach(m => { const s = m.val(); slider.innerHTML += `<div class="slide" onclick="openPlayer('${s.url}')"><img src="${s.poster}"><div style="position:absolute; bottom:20px; left:20px;"><h2>${s.title}</h2></div></div>`; });
                });
            });

            // Live Channels
            db.ref('channels').on('value', snap => {
                const l = document.getElementById('live-list'); l.innerHTML = '';
                snap.forEach(c => { const ch = c.val(); l.innerHTML += `<div class="card" onclick="openPlayer('${ch.url}', '${ch.licUrl}', '${ch.token}')" style="text-align:center;"><img src="${ch.logo}" style="width:100%; border-radius:20px;"><p style="font-size:10px; font-weight:800; margin-top:5px;">${ch.name}</p></div>`; });
            });

            // Movies List
            db.ref('movies').on('value', snap => {
                const l = document.getElementById('movie-list'); l.innerHTML = '';
                snap.forEach(m => { const v = m.val(); l.innerHTML += `<div class="card" onclick="openPlayer('${v.url}')"><img src="${v.poster}" style="width:100%; border-radius:25px;"><h4>${v.title}</h4></div>`; });
            });
        }

        // --- CHAT WITH REPLY & BOTTOM LAYOUT ---
        function setChatMode(t) {
            activeChat = t;
            document.getElementById('btn-pub').style.background = t==='public'?'var(--red)':'transparent';
            document.getElementById('btn-bot').style.background = t==='bot'?'var(--red)':'transparent';
            listenChat();
        }
        function listenChat() {
            const p = activeChat==='public' ? 'public_chat' : 'bot_chat/'+auth.currentUser.uid;
            db.ref(p).limitToLast(30).on('value', snap => {
                const b = document.getElementById('chat-messages'); b.innerHTML = '';
                snap.forEach(m => {
                    const d = m.val(); const isMe = d.uid === auth.currentUser.uid;
                    let replyTag = d.replyTo ? `<div class="reply-box">Reply: ${d.replyTo.text.substring(0,30)}...</div>` : '';
                    b.innerHTML += `<div class="msg-bubble ${isMe ? 'msg-sent' : 'msg-received'}" onclick="setReply('${d.name}', '${d.text}')">${!isMe && activeChat==='public' ? `<span class="msg-info">${d.name}</span>` : ''}${replyTag}${d.text}</div>`;
                });
                b.scrollTop = b.scrollHeight;
            });
        }
        function setReply(name, text) { replyTarget = {name, text}; document.getElementById('reply-bar').style.display='flex'; document.getElementById('reply-info').innerText="Replying to "+name; }
        function cancelReply() { replyTarget = null; document.getElementById('reply-bar').style.display='none'; }
        function sendMsg() {
            const i = document.getElementById('chat-input'); if(!i.value) return;
            const p = activeChat==='public' ? 'public_chat' : 'bot_chat/'+auth.currentUser.uid;
            db.ref(p).push({ uid: auth.currentUser.uid, name: auth.currentUser.displayName || 'User', text: i.value, replyTo: replyTarget, timestamp: Date.now() });
            i.value = ''; cancelReply();
        }

        // --- NAV & SUB-PAGES ---
        function navTo(id, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active-page'));
            document.getElementById(id).classList.add('active-page');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            if(el) el.classList.add('active');
            const isC = id === 'chat';
            document.getElementById('bottom-nav').style.display = isC ? 'none' : 'flex';
            document.getElementById('main-header').style.display = isC ? 'none' : 'flex';
            document.getElementById('chat-header').style.display = isC ? 'flex' : 'none';
            if(isC) setChatMode('public');
        }
        function closeChat() { navTo('live', document.querySelector('.nav-item')); }

        function openSub(type) {
            const id = type+'-sub'; document.getElementById(id).style.display='block';
            if(type==='stories') renderStories();
            if(type==='tech') renderTech();
            if(type==='betting') renderBetting();
            if(type==='download') renderDownloads();
        }
        function closeSub(id) { document.getElementById(id).style.display='none'; }

        // Render functions for sub-pages
        function renderStories() {
            db.ref('simulizi').once('value', snap => {
                const r = document.getElementById('stories-render'); r.innerHTML = '';
                snap.forEach(s => { const st = s.val(); r.innerHTML += `<div class="card" onclick="readStory('${s.key}')" style="display:flex; gap:15px; align-items:center;"><img src="${st.cover}" style="width:70px; height:105px; border-radius:15px; object-fit:cover;"><div><h4>${st.title}</h4><p style="font-size:12px; opacity:0.6;">By ${st.author}</p></div></div>`; });
            });
        }
        function renderTech() { db.ref('tech').on('value', snap => { const r = document.getElementById('tech-render'); r.innerHTML = ''; snap.forEach(t => { const v = t.val(); r.innerHTML += `<div class="card"><h4>${v.title}</h4><p style="font-size:13px; opacity:0.7; margin-top:10px;">${v.content}</p></div>`; }); }); }
        function renderBetting() { db.ref('betting').on('value', snap => { const r = document.getElementById('betting-render'); r.innerHTML = ''; snap.forEach(b => { const v = b.val(); r.innerHTML += `<div class="card" style="text-align:center;"><p class="red-txt">${v.match}</p><h4>${v.tip}</h4><p>Odds: ${v.odds}</p></div>`; }); }); }
        function renderDownloads() { db.ref('downloads').on('value', snap => { const r = document.getElementById('download-render'); r.innerHTML = ''; snap.forEach(d => { const v = d.val(); r.innerHTML += `<div class="card" style="display:flex; justify-content:space-between; align-items:center;"><h4>${v.title}</h4><i class="fa-solid fa-cloud-arrow-down" onclick="window.open('${v.link}')" style="font-size:24px; color:var(--red)"></i></div>`; }); }); }

        // --- STORY READER ---
        let sData, sPart=0;
        function readStory(id) {
            db.ref('simulizi/'+id).once('value', snap => {
                sData = snap.val(); sPart = 0;
                document.getElementById('read-title').innerText = sData.title;
                document.getElementById('read-author').innerText = "Written by "+sData.author;
                document.getElementById('read-bg').style.backgroundImage = `url('${sData.cover}')`;
                updateReader();
                document.getElementById('reader-view').style.display = 'block';
            });
        }
        function updateReader() { document.getElementById('read-body').innerText = sData.parts[sPart].content; }
        function turnStoryPage(dir) { if(dir>0 && sPart<sData.parts.length-1) sPart++; else if(dir<0 && sPart>0) sPart--; updateReader(); }
        function exitReader() { document.getElementById('reader-view').style.display = 'none'; }

        // --- PLAYER ---
        let vjs = videojs('stany-player');
        function openPlayer(u, l, t) {
            triggerAd(() => {
                document.getElementById('player-view').classList.remove('hidden');
                let conf = { src: u, type: u.includes('.mpd') ? 'application/dash+xml' : 'application/x-mpegURL' };
                if(l) conf.keySystems = { 'com.widevine.alpha': { url: l, headers: { 'Authorization': t ? 'Bearer '+t : '' } } };
                vjs.src(conf); vjs.play();
            });
        }
        function stopPlayer() { vjs.pause(); document.getElementById('player-view').classList.add('hidden'); }

        function unlockAdult() {
            document.getElementById('age-gate').classList.add('hidden');
            document.getElementById('adult-content').classList.remove('hidden');
            db.ref('adult').on('value', snap => {
                const l = document.getElementById('adult-list'); l.innerHTML = '';
                snap.forEach(a => { const v = a.val(); l.innerHTML += `<div class="card" onclick="openPlayer('${v.url}')"><img src="${v.poster}" style="width:100%; border-radius:20px;"><h4>${v.title}</h4></div>`; });
            });
        }
        function signOutAccount() { auth.signOut(); location.reload(); }
    </script>
</body>
</html>
