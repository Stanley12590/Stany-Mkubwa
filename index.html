<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>STANY MIN TV | iOS 26 OFFICIAL</title>
    
    <!-- Icons: FontAwesome (No Emojis) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <!-- Video Player (EME/DRM) -->
    <link href="https://vjs.zencdn.net/7.20.3/video-js.css" rel="stylesheet" />
    <script src="https://vjs.zencdn.net/7.20.3/video.min.js"></script>
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.10.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.10.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.10.0/firebase-database-compat.js"></script>

    <style>
        :root {
            --red: #FF0000;
            --black: #000000;
            --white: #FFFFFF;
            --glass: rgba(255, 255, 255, 0.08);
            --blur: blur(40px);
            --sent: #FF0000;
            --received: #1C1C1E;
        }

        * {
            margin: 0; padding: 0; box-sizing: border-box;
            font-family: 'SF Pro Display', -apple-system, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body { background-color: var(--black); color: var(--white); overflow: hidden; height: 100vh; }

        /* --- iOS 26 Auth & Splash --- */
        #auth-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--black); z-index: 10000;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .auth-card {
            background: var(--glass); backdrop-filter: var(--blur);
            padding: 35px; border-radius: 40px; width: 90%; text-align: center;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .ios-input {
            width: 100%; padding: 16px; margin-top: 15px;
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 15px; color: white; outline: none;
        }

        /* --- Ultimate Ad Engine --- */
        #ad-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--black); z-index: 9500; display: none; flex-direction: column;
        }
        .marquee-ad { background: var(--red); color: white; padding: 10px; font-weight: bold; overflow: hidden; font-size: 13px; }
        .marquee-ad span { display: inline-block; white-space: nowrap; animation: marquee 15s linear infinite; }
        @keyframes marquee { from { transform: translateX(100%); } to { transform: translateX(-100%); } }
        .ad-timer { position: absolute; top: 50px; right: 25px; border: 2.5px solid var(--red); width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 800; background: rgba(0,0,0,0.85); }

        /* --- Header & Floating Nav --- */
        header {
            padding: 60px 20px 15px; background: rgba(0,0,0,0.8);
            backdrop-filter: var(--blur); position: sticky; top: 0; z-index: 800;
            display: flex; justify-content: space-between; align-items: center;
        }
        .logo-text { font-size: 26px; font-weight: 800; }
        .red-txt { color: var(--red); }

        .bottom-nav {
            position: fixed; bottom: 30px; left: 20px; right: 20px;
            height: 75px; background: rgba(18, 18, 18, 0.8);
            backdrop-filter: var(--blur); border-radius: 40px;
            display: flex; justify-content: space-around; align-items: center;
            border: 1px solid rgba(255,255,255,0.1); z-index: 1000;
        }
        .nav-item { text-align: center; color: #666; text-decoration: none; font-size: 10px; font-weight: 700; }
        .nav-item i { font-size: 24px; display: block; margin-bottom: 5px; }
        .nav-item.active { color: var(--red); }

        /* --- Advanced Chat (Keyboard Aligned) --- */
        #chat-header {
            position: fixed; top: 0; left: 0; width: 100%; padding: 60px 20px 15px;
            background: var(--black); display: none; align-items: center; z-index: 1100;
            border-bottom: 1px solid var(--glass);
        }
        #chat-container {
            height: 100vh; display: flex; flex-direction: column; justify-content: flex-end;
            padding-bottom: 165px;
        }
        #chat-messages {
            overflow-y: auto; padding: 20px;
            display: flex; flex-direction: column; gap: 10px;
        }
        .msg-bubble { padding: 12px 18px; border-radius: 22px; max-width: 80%; font-size: 15px; line-height: 1.4; }
        .msg-sent { background: var(--sent); align-self: flex-end; border-bottom-right-radius: 4px; }
        .msg-received { background: var(--received); align-self: flex-start; border-bottom-left-radius: 4px; }
        .reply-tag { background: rgba(255,255,255,0.1); border-left: 3px solid var(--white); padding: 5px 10px; border-radius: 8px; font-size: 11px; margin-bottom: 5px; }

        .chat-input-area {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: var(--black); padding: 15px 20px 45px;
            border-top: 1px solid var(--glass); z-index: 1200;
        }

        /* --- More Services Sub-Pages --- */
        .sub-page {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--black); z-index: 2000; display: none;
            padding: 70px 20px; overflow-y: auto;
        }

        /* --- Dynamic Sliding Carousels --- */
        .carousel { display: flex; overflow-x: auto; scroll-snap-type: x mandatory; gap: 15px; padding-bottom: 15px; scrollbar-width: none; }
        .carousel::-webkit-scrollbar { display: none; }
        .slide {
            min-width: 88%; height: 210px; border-radius: 30px; 
            scroll-snap-align: center; position: relative; overflow: hidden;
            border: 1px solid var(--glass);
        }
        .slide img { width: 100%; height: 100%; object-fit: cover; }

        /* Simulizi Reader (Drop Image) */
        .reader-view { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--black); z-index: 3000; display: none; }
        .drop-image-bg {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-size: cover; background-position: center;
            filter: blur(60px) brightness(0.25); z-index: -1;
        }

        .card { background: var(--glass); backdrop-filter: var(--blur); border-radius: 25px; border: 1px solid rgba(255,255,255,0.06); padding: 18px; margin-bottom: 15px; }
        .btn-red { background: var(--red); color: white; border: none; padding: 18px; border-radius: 30px; font-weight: 700; width: 100%; cursor: pointer; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <!-- Auth System -->
    <div id="auth-screen">
        <div class="auth-card" id="login-box">
            <div style="width: 85px; height: 85px; border: 4px solid var(--red); border-radius: 22px; margin: 0 auto 25px; animation: pulse 2s infinite;"></div>
            <h1 style="font-weight: 800;">STANY <span class="red-txt">MIN TV</span></h1>
            <div id="auth-fields">
                <input type="email" id="email" class="ios-input" placeholder="Email Address">
                <input type="password" id="pass" class="ios-input" placeholder="Password">
                <button class="btn-red" style="margin-top:20px" onclick="handleAuth('login')">Sign In</button>
                <button class="btn-red" style="background:transparent; border:1px solid var(--red); margin-top:10px" onclick="toggleAuth('reg')">Register Now</button>
            </div>
            <button class="btn-red" style="background:white; color:black; margin-top:20px" onclick="googleAuth()">
                <i class="fa-brands fa-google"></i> Continue with Google
            </button>
        </div>
        <div class="auth-card hidden" id="reg-box">
            <h2>Sign Up</h2>
            <input type="text" id="reg-name" class="ios-input" placeholder="Full Name">
            <input type="email" id="reg-email" class="ios-input" placeholder="Email">
            <input type="password" id="reg-pass" class="ios-input" placeholder="Password">
            <button class="btn-red" onclick="handleAuth('reg')">Create Account</button>
            <p onclick="toggleAuth('login')" style="margin-top:20px; font-size:12px; opacity:0.6">Already have an account? Login</p>
        </div>
    </div>

    <!-- Ad Engine Overlay -->
    <div id="ad-overlay">
        <div class="marquee-ad"><span>• ADVERTISEMENT • VISIT STANYMINTV.COM • OFFICIAL PARTNER • UNSKIPPABLE ACCESS •</span></div>
        <div style="flex:1; display:flex; align-items:center; justify-content:center; position:relative;">
            <div class="ad-timer" id="ad-timer">15</div>
            <img id="ad-img" style="width:100%; max-height:75vh; object-fit:contain;">
        </div>
        <div id="ad-social-hub" style="display:grid; grid-template-columns:repeat(6, 1fr); gap:15px; padding:25px; background:var(--glass);"></div>
        <div class="marquee-ad"><span>• POWERED BY STANY MIN TV PRO • CLICK ICONS TO JOIN SPONSOR •</span></div>
    </div>

    <!-- Header -->
    <header id="main-header">
        <div class="logo-text">STANY <span class="red-txt">MIN</span></div>
        <i class="fa-solid fa-magnifying-glass" style="font-size: 22px;"></i>
    </header>

    <div id="chat-header">
        <i class="fa-solid fa-chevron-left" style="font-size: 26px; color: var(--red);" onclick="closeChat()"></i>
        <span style="margin-left: 20px; font-weight: 800;">MESSAGES</span>
    </div>

    <main>
        <!-- Section: Live TV -->
        <section id="live" class="page active-page">
            <div class="carousel" id="live-carousel"></div>
            <h3 style="margin-bottom:20px;"><i class="fa-solid fa-satellite-dish red-txt"></i> &nbsp; Live Channels</h3>
            <div id="live-list" style="display:grid; grid-template-columns:repeat(3, 1fr); gap:12px;"></div>
        </section>

        <!-- Section: Movies -->
        <section id="movies" class="page">
            <div class="carousel" id="movie-carousel"></div>
            <h3 style="margin:25px 0 15px;"><i class="fa-solid fa-film red-txt"></i> &nbsp; Cinema Library</h3>
            <div id="movie-list" style="display:grid; grid-template-columns:repeat(2, 1fr); gap:15px;"></div>
        </section>

        <!-- Section: Adult -->
        <section id="adult" class="page">
            <div id="age-gate" class="card" style="text-align:center; padding:60px 20px;">
                <i class="fa-solid fa-circle-exclamation" style="font-size:55px; color:var(--red);"></i>
                <h2 style="margin:20px 0;">18+ Warning</h2>
                <p style="opacity:0.7;">This section is restricted to adults. Enter?</p>
                <button class="btn-red" style="margin-top:20px" onclick="unlockAdult()">Yes, I am 18+</button>
            </div>
            <div id="adult-content" class="hidden">
                <div class="carousel" id="adult-carousel"></div>
                <div id="adult-list" style="display:grid; grid-template-columns:repeat(2, 1fr); gap:15px;"></div>
            </div>
        </section>

        <!-- Section: Chat -->
        <section id="chat" class="page" style="padding:0;">
            <div id="chat-container">
                <div style="display:flex; background:var(--glass); border-radius:20px; padding:5px; margin: 100px 20px 10px;">
                    <div id="sw-public" style="flex:1; text-align:center; padding:10px; border-radius:15px; cursor:pointer;" onclick="setChat('public')">PUBLIC</div>
                    <div id="sw-bot" style="flex:1; text-align:center; padding:10px; border-radius:15px; cursor:pointer;" onclick="setChat('bot')">STANY BOT</div>
                </div>
                <div id="chat-messages"></div>
                <div class="chat-input-area">
                    <div id="reply-preview" style="display:none; background:var(--received); padding:8px 20px; border-radius:15px; margin-bottom:10px; justify-content:space-between;">
                        <span id="reply-name" style="font-size:12px; opacity:0.7;"></span>
                        <i class="fa-solid fa-xmark" onclick="cancelReply()"></i>
                    </div>
                    <div style="display:flex; gap:10px;">
                        <input type="text" id="msg-input" class="ios-input" style="margin:0; border-radius:30px;" placeholder="Aa...">
                        <button onclick="sendMsg()" style="background:var(--red); border:none; width:50px; height:50px; border-radius:50%; color:white;"><i class="fa-solid fa-paper-plane"></i></button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section: More Services -->
        <section id="more" class="page">
            <div class="carousel" id="more-carousel"></div>
            <h3 style="margin-bottom:25px;">Library & <span class="red-txt">Services</span></h3>
            <div class="card" onclick="openSub('stories')"><i class="fa-solid fa-book red-txt"></i> &nbsp; Stories (Simulizi)</div>
            <div class="card" onclick="openSub('tech')"><i class="fa-solid fa-microchip red-txt"></i> &nbsp; Tech Updates</div>
            <div class="card" onclick="openSub('betting')"><i class="fa-solid fa-chart-line red-txt"></i> &nbsp; Betting Tips</div>
            <div class="card" onclick="openSub('download')"><i class="fa-solid fa-download red-txt"></i> &nbsp; Downloads</div>
            <div class="card" onclick="logout()"><i class="fa-solid fa-power-off"></i> &nbsp; Sign Out</div>
        </section>
    </main>

    <!-- Sub Pages Content -->
    <div id="stories-page" class="sub-page">
        <i class="fa-solid fa-chevron-left" onclick="closeSub('stories-page')" style="font-size:26px; margin-bottom:20px;"></i>
        <div id="story-render"></div>
    </div>
    <div id="tech-page" class="sub-page">
        <i class="fa-solid fa-chevron-left" onclick="closeSub('tech-page')" style="font-size:26px; margin-bottom:20px;"></i>
        <div id="tech-render"></div>
    </div>

    <!-- Reader View -->
    <div id="reader-view" class="reader-view">
        <div class="drop-image-bg" id="read-bg"></div>
        <div style="flex:1; overflow-y:auto; padding:60px 25px;">
            <i class="fa-solid fa-chevron-down" onclick="exitReader()" style="font-size:30px; margin-bottom:30px;"></i>
            <h1 id="read-title" class="red-txt" style="text-align:center;"></h1>
            <p id="read-author" style="text-align:center; opacity:0.6; margin-bottom:30px;"></p>
            <div class="card" style="background:rgba(0,0,0,0.6);" id="read-body"></div>
            <div style="display:flex; justify-content:space-between; margin-top:30px;">
                <button class="btn-red" style="width:45%; background:#222;" onclick="turnPage(-1)">BACK</button>
                <button class="btn-red" style="width:45%;" onclick="turnPage(1)">NEXT</button>
            </div>
        </div>
    </div>

    <!-- Floating Nav -->
    <div class="bottom-nav" id="bottom-nav">
        <a href="javascript:void(0)" class="nav-item active" onclick="navTo('live', this)"><i class="fa-solid fa-tv"></i>Live</a>
        <a href="javascript:void(0)" class="nav-item" onclick="navTo('movies', this)"><i class="fa-solid fa-film"></i>Movies</a>
        <a href="javascript:void(0)" class="nav-item" onclick="navTo('adult', this)"><i class="fa-solid fa-pepper-hot"></i>Adult</a>
        <a href="javascript:void(0)" class="nav-item" onclick="navTo('chat', this)"><i class="fa-solid fa-comments"></i>Chat</a>
        <a href="javascript:void(0)" class="nav-item" onclick="navTo('more', this)"><i class="fa-solid fa-grip-vertical"></i>More</a>
    </div>

    <!-- Player Window -->
    <div id="player-view" class="hidden" style="position:fixed; top:0; left:0; width:100%; height:100%; background:#000; z-index:9000;">
        <i class="fa-solid fa-xmark" onclick="stopPlayer()" style="position:absolute; top:45px; right:25px; z-index:9100; font-size: 35px;"></i>
        <video id="stany-player" class="video-js vjs-big-play-centered" controls style="width:100%; height:100%;"></video>
    </div>

    <script>
        // --- FIREBASE CONFIGURATION ---
        const firebaseConfig = {
            apiKey: "AIzaSyDiexD5WK9GLhQldr6zNmC8iYWc4em5eyM",
            authDomain: "stany-min-tv.firebaseapp.com",
            databaseURL: "https://stany-min-tv-default-rtdb.firebaseio.com",
            projectId: "stany-min-tv",
            storageBucket: "stany-min-tv.firebasestorage.app",
            messagingSenderId: "16513327552",
            appId: "1:16513327552:web:b4b2247053f83aa0b8e825",
            measurementId: "G-JM25LJXL5C"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const auth = firebase.auth();

        let currentUser = null, isPremium = false, activeChat = 'public', replyData = null;
        let myHWID = localStorage.getItem('hwid') || 'STANY-'+Math.random().toString(36).substr(2,9);
        localStorage.setItem('hwid', myHWID);

        // --- AUTH LOGIC ---
        function toggleAuth(t) { document.getElementById('login-box').classList.toggle('hidden', t==='reg'); document.getElementById('reg-box').classList.toggle('hidden', t==='login'); }
        function googleAuth() { auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()).then(r => checkHWID(r.user)); }
        function handleAuth(m) {
            if(m==='reg') {
                const e = document.getElementById('reg-email').value, p = document.getElementById('reg-pass').value;
                auth.createUserWithEmailAndPassword(e, p).then(r => {
                    r.user.updateProfile({displayName: document.getElementById('reg-name').value});
                    checkHWID(r.user);
                }).catch(err => alert(err.message));
            } else {
                const e = document.getElementById('email').value, p = document.getElementById('pass').value;
                auth.signInWithEmailAndPassword(e, p).then(r => checkHWID(r.user)).catch(err => alert(err.message));
            }
        }
        function checkHWID(user) {
            db.ref('users/'+user.uid).once('value', s => {
                const u = s.val();
                if(u && u.hwid && u.hwid !== myHWID) { alert("Device mismatch detected."); auth.signOut(); location.reload(); }
                else {
                    if(!u || !u.hwid) db.ref('users/'+user.uid).update({hwid: myHWID, email: user.email, name: user.displayName || 'User'});
                    isPremium = u ? u.isPremium : false;
                    document.getElementById('auth-screen').style.display = 'none';
                    initApp();
                }
            });
        }
        auth.onAuthStateChanged(u => { if(u) checkHWID(u); });

        // --- AD ENGINE ---
        function triggerAd(cb) {
            if(isPremium) return cb();
            const ov = document.getElementById('ad-overlay'); ov.style.display = 'flex';
            db.ref('ads/config').once('value', s => {
                const c = s.val(); document.getElementById('ad-img').src = c.image;
                const h = document.getElementById('ad-social-hub'); h.innerHTML = '';
                if(c.socialHub) c.socialHub.forEach(i => h.innerHTML += `<i class="${i.icon}" onclick="window.open('${i.url}')" style="text-align:center; font-size:24px; color:white;"></i>`);
                let t = c.duration || 15;
                const timer = setInterval(() => {
                    t--; document.getElementById('ad-timer').innerText = t;
                    if(t<=0) { clearInterval(timer); ov.style.display = 'none'; cb(); }
                }, 1000);
            });
        }

        // --- LOAD APP DATA ---
        function initApp() {
            // Section Carousels
            ['live', 'movie', 'adult', 'more'].forEach(type => {
                db.ref('carousels/'+type).on('value', snap => {
                    const slider = document.getElementById(type+'-carousel'); if(!slider) return; slider.innerHTML = '';
                    snap.forEach(m => { const s = m.val(); slider.innerHTML += `<div class="slide" onclick="openPlayer('${s.url}')"><img src="${s.poster}"><div style="position:absolute; bottom:15px; left:15px;"><h2>${s.title}</h2></div></div>`; });
                });
            });

            // Channels
            db.ref('channels').on('value', snap => {
                const l = document.getElementById('live-list'); l.innerHTML = '';
                snap.forEach(c => { const ch = c.val(); l.innerHTML += `<div class="card" onclick="openPlayer('${ch.url}', '${ch.licUrl}', '${ch.token}')" style="text-align:center;"><img src="${ch.logo}" style="width:100%; border-radius:15px;"><p style="font-size:10px; font-weight:700; margin-top:5px;">${ch.name}</p></div>`; });
            });

            // Movies
            db.ref('movies').on('value', snap => {
                const l = document.getElementById('movie-list'); l.innerHTML = '';
                snap.forEach(m => { const v = m.val(); l.innerHTML += `<div class="card" onclick="openPlayer('${v.url}')"><img src="${v.poster}" style="width:100%; border-radius:20px;"><h4>${v.title}</h4></div>`; });
            });
        }

        // --- CHAT LOGIC ---
        function setChat(t) {
            activeChat = t;
            document.getElementById('sw-public').style.background = t==='public' ? 'var(--red)' : 'transparent';
            document.getElementById('sw-bot').style.background = t==='bot' ? 'var(--red)' : 'transparent';
            listenChat();
        }
        function listenChat() {
            const p = activeChat==='public' ? 'public_chat' : 'bot_chat/'+auth.currentUser.uid;
            db.ref(p).limitToLast(25).on('value', snap => {
                const b = document.getElementById('chat-messages'); b.innerHTML = '';
                snap.forEach(m => {
                    const d = m.val(); const isMe = d.uid === auth.currentUser.uid;
                    let replyHtml = d.replyTo ? `<div class="reply-box">Replying to ${d.replyTo.name}: ${d.replyTo.text.substring(0,20)}...</div>` : '';
                    b.innerHTML += `<div class="msg-bubble ${isMe ? 'msg-sent' : 'msg-received'}" onclick="setReply('${d.name}', '${d.text}')">${!isMe && activeChat==='public' ? `<div style="font-size:10px; font-weight:800; opacity:0.6; margin-bottom:4px;">${d.name}</div>`:''}${replyHtml}${d.text}</div>`;
                });
                b.scrollTop = b.scrollHeight;
            });
        }
        function setReply(name, text) { replyData = {name, text}; document.getElementById('reply-preview').style.display='flex'; document.getElementById('reply-name').innerText="Replying to "+name; }
        function cancelReply() { replyData = null; document.getElementById('reply-preview').style.display='none'; }
        function sendMsg() {
            const i = document.getElementById('msg-input'); if(!i.value) return;
            const p = activeChat==='public' ? 'public_chat' : 'bot_chat/'+auth.currentUser.uid;
            db.ref(p).push({ uid: auth.currentUser.uid, name: auth.currentUser.displayName || 'User', text: i.value, replyTo: replyData, timestamp: Date.now() });
            i.value = ''; cancelReply();
        }

        // --- NAVIGATION ---
        function navTo(id, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active-page'));
            document.getElementById(id).classList.add('active-page');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            if(el) el.classList.add('active');
            const isC = id === 'chat';
            document.getElementById('bottom-nav').style.display = isC ? 'none' : 'flex';
            document.getElementById('main-header').style.display = isC ? 'none' : 'flex';
            document.getElementById('chat-header').style.display = isC ? 'flex' : 'none';
            if(isC) setChat('public');
        }
        function closeChat() { navTo('live', document.querySelector('.nav-item')); }

        // --- MORE SERVICES ---
        function openSub(id) {
            if(id==='stories') { document.getElementById('stories-page').style.display='block'; renderStories(); }
            if(id==='tech') { document.getElementById('tech-page').style.display='block'; renderTech(); }
        }
        function closeSub(id) { document.getElementById(id).style.display='none'; }

        function renderStories() {
            db.ref('simulizi').once('value', snap => {
                const r = document.getElementById('story-render'); r.innerHTML = '';
                snap.forEach(s => { const st = s.val(); r.innerHTML += `<div class="card" onclick="readStory('${s.key}')" style="display:flex; gap:15px; align-items:center;"><img src="${st.cover}" style="width:70px; height:100px; border-radius:12px; object-fit:cover;"><div><h4>${st.title}</h4><p style="font-size:12px; opacity:0.6;">By ${st.author}</p></div></div>`; });
            });
        }

        // --- PLAYER ---
        let player = videojs('stany-player');
        function openPlayer(u, l, t) {
            triggerAd(() => {
                document.getElementById('player-view').classList.remove('hidden');
                let conf = { src: u, type: u.includes('.mpd') ? 'application/dash+xml' : 'application/x-mpegURL' };
                if(l) conf.keySystems = { 'com.widevine.alpha': { url: l, headers: { 'Authorization': t ? 'Bearer '+t : '' } } };
                player.src(conf); player.play();
            });
        }
        function stopPlayer() { player.pause(); document.getElementById('player-view').classList.add('hidden'); }

        // --- STORY READER ---
        let sData, sPart=0;
        function readStory(id) {
            db.ref('simulizi/'+id).once('value', snap => {
                sData = snap.val(); sPart = 0;
                document.getElementById('read-title').innerText = sData.title;
                document.getElementById('read-author').innerText = "By "+sData.author;
                document.getElementById('read-bg').style.backgroundImage = `url('${sData.cover}')`;
                updateReader();
                document.getElementById('reader-view').style.display = 'block';
            });
        }
        function updateReader() { document.getElementById('read-body').innerText = sData.parts[sPart].content; }
        function turnPage(d) { if(d>0 && sPart<sData.parts.length-1) sPart++; else if(d<0 && sPart>0) sPart--; updateReader(); }
        function exitReader() { document.getElementById('reader-view').style.display = 'none'; }

        function unlockAdult() {
            document.getElementById('age-gate').classList.add('hidden');
            document.getElementById('adult-content').classList.remove('hidden');
            db.ref('adult').on('value', snap => {
                const l = document.getElementById('adult-list'); l.innerHTML = '';
                snap.forEach(a => { const v = a.val(); l.innerHTML += `<div class="card" onclick="openPlayer('${v.url}')"><img src="${v.poster}" style="width:100%; border-radius:15px;"><h4>${v.title}</h4></div>`; });
            });
        }
        function logout() { auth.signOut(); location.reload(); }
    </script>
</body>
</html>
